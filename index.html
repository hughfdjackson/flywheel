<html>
<head>
<title>Flywheel Example</title>
<style type="text/css">

body {
    background-color: #000
}

canvas {
    display: block;
    margin: 100px auto;
    background-color: #fff
}

</style>
</head>
<body>

<canvas id="main_canvas" width="350" height="300"></canvas>

<script type="text/javascript" src="../ender.js"></script>

<script type="text/javascript">

!function(){
    // get our canvas element and make a 2d context for it
    var canvas = document.getElementById("main_canvas"),
        context = canvas.getContext("2d"),
        // get flywheel out from the package
        flywheel = require("flywheel"),
        // bouncing ball constructor
        BB = function(){
        // make an object with a simple draw and update function
            return {
                x: (Math.random() * canvas.width),
                y: (Math.random() * 100) - 100,
                yVel: 1,    // the velocity of the ball on the x and y axis
                xVel: (Math.random() * 200) - 100,
                gravity: 400, // num pix per second downwards acceleration
                radius: 10,
				calculate_red: function(){
					var proportion_down_screen = this.y/canvas.height
					return Math.floor(proportion_down_screen * 256)
				},
				calculate_blue: function(){
					var proportion_across_screen = this.x/canvas.width
					return Math.floor(proportion_across_screen * 256)
				},
                draw: function(){
					var red = this.calculate_red()
					context.fillStyle = 'rgb(' + this.calculate_red() + ', 0,' + this.blue + ')'
                    // create circle shape                
                    context.beginPath();
                    context.arc(this.x, this.y, this.radius, 0, Math.PI*2, true);
                    context.closePath();
                    
                    // draw it to the canvas
                    context.fill();
                },
                update: function(time_delta){
                    // move the ball down towards the 'floor'
                    this.yVel += this.gravity * time_delta/1000
                    this.y += this.yVel * time_delta/1000
                                        
                    // if we've hit the 'floor', bounce
                    if ( this.y > canvas.height - this.radius ){ 
                        this.yVel = -this.yVel * 0.9                
                        this.y = canvas.height - this.radius
                    }
                    
                    // move the ball across the scene
                    this.x += this.xVel * time_delta/1000
                    
                    // emulate friction with the floor
                    if ( this.y >= canvas.height - this.radius && this.xVel != 0 ) {
                        
                        var deceleration_scalar = (1 * time_delta/1000)
                        if ( this.xVel > 0 ) this.xVel -= this.xVel * deceleration_scalar
                            else this.xVel += this.xVel * deceleration_scalar
                                      
                    }
                      
                    // if we've hit the 'walls'
                    if ( this.x > canvas.width - this.radius ) {
                        this.xVel = -this.xVel * 0.92
                        this.x = canvas.width - this.radius
                    } else if ( this.x < this.radius ) {
                        this.xVel = -this.xVel * 0.92
                        this.x = this.radius           
                    }
                },
				init: function(){
					this.blue = this.calculate_blue()
					return this
				}
            }
            
        }

                
        var balls = []
        for ( var i = 0; i < 100; i += 1) balls.push(BB().init())
                
        // loop it using flywheel
        flywheel(function(time_delta){
            context.clearRect(0, 0, canvas.width, canvas.height)
            
            var i = balls.length;
            while ( i-- ) {
                balls[i].update(time_delta)
                balls[i].draw()
            }
        
        }).start()
}()
</script>
</body>
</html>
